function distance = DistanceToEllipse(E, pos);   %When called from a new graph, ther is nothing to check, but E may have%leftover bits inif isempty(E) | ~isfield(E,'pos') | ~isfield(E,'angle');    distance = NaN;    return;endif E.shape == 1r(1) = AllV.LineLength(E.pos)/3;r(2) = r(1)./10;a(1) = (E.pos(3)+E.pos(1))/2; %x radiusa(2) = (E.pos(4)+E.pos(2))/2;xy = pos - a;xy = xy ./r;cn = cos(-E.angle);sn = sin(-E.angle);p(1) = xy(1) * cn + xy(2) * sn;p(2) = xy(2) * cn - xy(1) * sn;distance = sum(p.^2);elser(1) = (E.pos(3)-E.pos(1))/2; %x radiusr(2) = (E.pos(4)-E.pos(2))/2;a(1) = (E.pos(3)+E.pos(1))/2; %x radiusa(2) = (E.pos(4)+E.pos(2))/2;xy = pos - a;xy = xy ./r;cn = cos(-E.angle);sn = sin(-E.angle);p(1) = xy(1) * cn + xy(2) * sn;p(2) = xy(2) * cn - xy(1) * sn;distance = sum(p.^2);end