function MiscMenu(a, b, type)    DATA = GetDataFromFig(a);    DATA = SaveCallback(DATA,a);    onoff = {'off' 'on'};    if sum(strcmp(type,{'savelayout' 'savedefaultlayout' 'savelastlayout'}))        Figpos = GetFigPos(DATA.toplevel);        if strcmp(type,'savelastlayout')            layoutfile = strrep(DATA.defaultlayout,'.layout','last.layout');            save(layoutfile,'Figpos');            return;        elseif isempty(DATA.layoutfile) || strcmp(type,'savedefaultlayout')             layoutfile = DATA.defaultlayout;        else            layoutfile = DATA.layoutfile;        end        [outname, pathname] = uiputfile(layoutfile);        if outname            DATA.layoutfile = [pathname outname];            save(DATA.layoutfile,'Figpos');            fprintf('Layout saved to %s\n',DATA.layoutfile);        end    elseif strcmp(type,'preferences')%        DATA = AllV.mysetappdata(DATA,'gui',DATA.gui);%        AppDataPopup(DATA, 'gui');        AllV.PreferencesPopup(DATA);    elseif strcmp(type,'loadlayout')        [afile, pathname] = uigetfile(DATA.layoutfile);        if ischar(afile)        DATA.layoutfile = [pathname afile];        AllV.ApplyLayout(DATA);        end    elseif sum(strcmp(type,{'savelastconfig'}))        DATA.PopupWindowData = getappdata(DATA.toplevel,'PopupWindowData');        outname = strrep(DATA.defaultconfig,'.config','last.config');        savefields = {'quickcutmode' 'probeswitchmode' 'auto' 'ptsz' 'plot' 'plotspk' 'gui' 'fullvswitchmode' 'quicksave' 'PopupWindowData' 'options'};        DATA.plotspk.probes = [];        SaveConfig(DATA, outname,savefields,'verbose');    elseif sum(strcmp(type,{'saveconfig' 'savedefaultconfig' 'savelastconfig'}))        DATA.PopupWindowData = getappdata(DATA.toplevel,'PopupWindowData');        if strcmp(type,'savedefaultconfig') || ~isfield(DATA,'configfile')            DATA.configfile = DATA.defaultconfig;        end        [outname, pathname] = uiputfile(DATA.configfile);        if outname            DATA.configfile = [pathname outname];            savefields = {'quickcutmode' 'probeswitchmode' 'auto' 'ptsz' 'plot' 'plotspk' 'gui' 'fullvswitchmode' 'quicksave' 'PopupWindowData' 'options'};            DATA.plotspk.probes = [];            SaveConfig(DATA, DATA.configfile,savefields,'verbose');        end    elseif strcmp(type,'scaledensity')        DATA.plot.scaledensity = ~DATA.plot.scaledensity;        set(a,'checked',onoff{1+DATA.plot.scaledensity});        AllV.ReplotPCs(DATA,[]);        set(DATA.toplevel,'UserData',DATA);    elseif strcmp(type,'loadconfig')        [afile, pathname] = uigetfile(DATA.configfile);        if ischar(afile)        DATA.configfile = [pathname afile];        DATA = ReadConfig(DATA, DATA.configfile);        end    elseif strcmp(type,'tofront')            FiguresToFront(DATA.tag);    elseif strcmp(type,'plotcelllist')        AllV.PlotCellList(DATA, 'showfig','reload');    endfigure(DATA.toplevel);    