function DATA = PlotCellList(DATA, varargin)plotmahal = 0;force = 0;reload = 0;j = 1;while j <= length(varargin)    if strncmpi(varargin{j},'showfig',5) %Force figure creation        force = 1;    elseif strncmpi(varargin{j},'reload',5) %reload from disk        reload = 1;    end    j = j+1;endif force    f = AllV.SetFigure(DATA.tag.celllist, DATA);else    f = findobj('Tag',DATA.tag.celllist,'type','figure');    if isempty(f)        return;    else        figure(f);    endendif reload        DATA = AllV.LoadCellFile(DATA);        set(DATA.toplevel,'UserData',DATA);endif isempty(DATA.CellList)    return;endcolors = mycolors;subplot(1,1,1);set(f,'UserData',DATA.toplevel);hold off;if plotmahalim = zeros(size(DATA.CellList));id = find(sum(DATA.CellList,3) > 0);X = squeeze(DATA.mahal(:,:,1));im(id) = X(id);endif ~isfield(DATA,'nclusters')    for j = 1:size(DATA.CellList,1)    for k = 1:size(DATA.CellList,2)        id = find(DATA.CellList(j,k,:) > 0);        DATA.nclusters(j,k) = length(id);    end    endendeid = find(DATA.CellDetails.exptids == DATA.exptno);PlotCellIm(DATA.CellList, DATA.CellDetails, DATA.nclusters,DATA.Comments);if isfield(DATA,'tagged')PlotCellIm('mark',DATA.tagged,'y');endif isfield(DATA.Comments, 'ec')    PlotCellIm('marklist',[ [DATA.Comments.ex]; [DATA.Comments.p];],'g');endtext(AllV.ProbeNumber(DATA),0,sprintf('P%d',AllV.ProbeNumber(DATA)),'color','r','fontsize',DATA.gui.fontsize(1));text(-1,eid,sprintf('E%.0f',DATA.exptno),'color','r','fontsize',DATA.gui.fontsize(1));return;offset = 0;nc = max(DATA.nclusters); %max # clusters in any one expt, for each probeif plotmahal    imagesc(im,'buttondownfcn',{@AllV.HitImage, 1});    caxis([0 5]);else    for j = 1:size(DATA.CellList,2)*2        CellIm(:,j) = DATA.CellList(:,ceil(j/2),1+offset);    end    id = find(nc >1);    for j = 1:length(id)        tid = find(DATA.nclusters(:,id(j)) > 1);        CellIm(tid,id(j)*2) = DATA.CellList(tid,id(j),offset+2);    end        imagesc([1 size(DATA.CellList,2)],[1 size(DATA.CellList,1)],CellIm,'buttondownfcn',{@AllV.HitImage, 3});endhold on;cells = unique(DATA.CellList(:,:,1+offset));cells = cells(cells > 0);for j = 1:length(cells)    [x,y] = find(DATA.CellList(:,:,1+offset) == cells(j));    for k = 1:length(y)        if DATA.nclusters(x(k),y(k)) > 1            plot([y(k)-0.25 y(k)-0.25], [x(k)-0.5 x(k)+0.5],'-','color',colors{j},'linewidth',2,'buttondownfcn',{@AllV.HitImage, 3});        else            plot([y(k) y(k)], [x(k)-0.5 x(k)+0.5],'-','color',colors{j},'linewidth',2,'buttondownfcn',{@AllV.HitImage, 3});        end    end    [a,b] = min(x);    h = text(y(b),x(b)-1,sprintf('%d',cells(j)),'fontsize',DATA.gui.fontsize(1));    set(h,'color',colors{j});endcells = unique(DATA.CellList(:,:,2+offset));cells = cells(cells > 0);for j = 1:length(cells)    [x,y] = find(DATA.CellList(:,:,2+offset) == cells(j));    for k = 1:length(y)            plot([y(k)+0.25 y(k)+0.25], [x(k)-0.5 x(k)+0.5],'-','color',colors{j},'linewidth',2,'buttondownfcn',{@AllV.HitImage, 3});    end    [a,b] = min(x);    h = text(y(b),x(b)-1,sprintf('%d',cells(j)),'fontsize',DATA.gui.fontsize(1));    set(h,'color',colors{j});endiscellim = sum(DATA.CellList,3) > 0;