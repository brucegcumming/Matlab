function DATA = ReClassify(DATA, varargin)    newbound = 0;    fittemplate = 0;    AllVoltages = AllV.mygetappdata(DATA,'AllVoltages');        j = 1;     while j <= length(varargin)        if strncmpi(varargin{j},'newboundary',4)            newbound = 1;        elseif strncmpi(varargin{j},'template',4)            fittemplate = 1;        end        j = j+1;    end        DATA.cluster = AllV.CheckForMean(DATA,DATA.cluster);    space = DATA.cluster.space;    oldms = DATA.cluster.MeanSpike.ms;    if size(DATA.cluster.gmfit.mu,2) == 6        DATA.cluster.space = [6 4];    end    if fittemplate        DATA =  AllV.CalcTemplatesFromMean(DATA,DATA.cluster.MeanSpike);        [a,b, DATA.xy{1}, details] = AllV.TemplateSpace(DATA,'template');        DATA.ndxy = DATA.xy{1};        fprintf('Template GM %.2f 6D %.2f 2d, %.2f1D\n',a(1),a(2),details.gmdprime)        DATA.cluster.gmfit = b;        DATA.cluster.gmdprime = details.gmdprime;        DATA.cluster.sign = details.cluster.sign;        DATA.cluster.crit = details.cluster.crit;        DATA.cluster.shape = 2;        DATA.cluster.angle = 0;        DATA.cluster.templatesrc = DATA.cluster.probe;        DATA.cluster.xy = DATA.xy{1}; %best ND;        DATA.cluster.xy(:,3) = DATA.TemplateScores(:,2); %sum of r        DATA.cluster.templatesrc = DATA.cluster.probe;        DATA.cluster.bestcl = details.bestcl;        DATA.cluster.usegmcluster = details.usegmcluster;    elseif ismember(DATA.cluster.space(1),[3 4]) & ~isfield(DATA,'TemplateScores')        DATA =  AllV.CalcTemplatesFromMean(DATA,DATA.cluster.MeanSpike);        a = DATA.cluster,space        DATA.xy{1}(:,1) = DATA.TemplateScores(space(2),:);        DATA.xy{1}(:,2) = DATA.TemplateScores(space(3),:);    elseif DATA.cluster.space(1) == 6 && DATA.cluster.space(2) == 4        DATA =  AllV.CalcTemplatesFromMean(DATA,DATA.cluster.MeanSpike);        DATA.plottype = 3;            [a,b, DATA.xy{1}, details] = AllV.BestSpace(DATA,'template');            DATA.ndxy = DATA.xy{1};            DATA.clst = details.cid;            DATA.cluster.gmfit = b;        DATA = AllV.ReplotPCs(DATA,[]);    elseif DATA.cluster.space(1) == 6        DATA.ndxy = AllV.ProjectND(DATA,DATA.cluster.space(2),DATA.cluster.gmfit);        if space(2) == 3 %ADC            DATA.plottype = 2;        elseif space(2) == 4 %template            DATA.plottype = 3;        else            DATA.plottype = 1;        end    elseif space(1) == 1        DATA.xy{1}(:,1) = DATA.pcs(DATA.uid,space(2));        DATA.xy{1}(:,2) = DATA.pcs(DATA.uid,space(3));        DATA.plottype = 1;    elseif space(1) == 3 || (space(1) ==6 && space(2) == 3)        DATA.xy{1}(:,1) = AllVoltages(DATA.probe(1),space(2), DATA.uid);        DATA.xy{1}(:,2) = AllVoltages(DATA.probe(1),space(3), DATA.uid);        DATA.plottype = 2;    end        if newbound%            [dip, details] = FindDip(DATA.xy{1}(:,1),DATA.energy(1,:),'gmix');%need to apply rotation to 2-D spaces first            [dip, details] = GMDip(DATA.xy{1},DATA.energy(1,:),'label',DATA.idstr);            DATA.cluster.crit = dip(1);            DATA.cluster.sign = details.sign;            DATA.cluster.gmdipres = details.dipres;            DATA.cluster.gmdprime = details.gmdprime;            DATA.cluster.autodipsize = details.dipsize;            DATA.cluster.dipsize = details.cdipsize;        end    [cl, cluster, DATA.xy{1}] = AllV.ClassifySpikes(DATA,DATA.cluster);    if newbound || fittemplate%if boundary changed, need to record new criterion, threshold/dropi etc.        DATA.cluster = cluster;    end    DATA.Cluster{DATA.probe(1)}.mahal = cluster.mahal;    DATA.clusterboundary{DATA.currentcluster} = AllV.CondenseCluster(AllV.BoundaryFromCluster([],cluster, DATA.currentcluster));    DATA.clid = cl.id;    DATA.nid = cl.nid;    DATA.clst = cl.clst;    DATA.MeanSpike = cl.MeanSpike;    DATA.cluster.MeanSpike = cl.MeanSpike;    DATA.cluster.minspke = prctile(DATA.energy(1,DATA.clid),1) .* 0.95;    DATA.cluster.minspkvar = prctile(DATA.spkvar(DATA.probe(1),DATA.clid),1) .* 0.95;    if fittemplate        DATA.cluster.xy = DATA.xy{1};        DATA.cluster.xy(:,3) = DATA.TemplateScores(:,2);        xc = corrcoef(oldms(:),DATA.cluster.MeanSpike.ms(:));        DATA.cluster.templatexc = xc(1,2);    end