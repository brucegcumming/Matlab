function name = SpkFileName(DATA, varargin)    p = AllV.ProbeNumber(DATA);    namemode = 'default';    j = 1;    while j <= length(varargin)        if strncmpi(varargin{j},'auto',4)            namemode = varargin{j};        elseif strncmpi(varargin{j},'probe',5)            j = j+1;             p = varargin{j};        end        j = j+1;    end    [a,b] = fileparts(DATA.name);    a = regexprep(a,'/$','');    if ~isempty(regexp(b,'Expt[0-9]*Spikes'))        [c,b] = fileparts(a);        b = regexprep(b,'Expt[0-9]*Spikes',c);    end    if isempty(b)        [c,b] = fileparts(a);    end    b = regexprep(b,'([GM][0-9]*).*','$1');    mnk = GetMonkeyName(DATA.name);    if isempty(strfind(b,mnk))        b = [mnk b];    end        if isdir(DATA.name)        a = DATA.name;    end    if strcmp(namemode,'auto')        spkname = '/AutoSpikes';    else        spkname = '/Spikes';    end    if length(DATA.clustersubdir)        spkdir = [a '/' DATA.clustersubdir spkname];    else        spkdir = [a spkname];    end        xs='';    if isfield(DATA,'Expt') && rem(DATA.Expt.exptno,1) > 0.001        xs = 'a';    end    eid = floor(DATA.Expt.exptno) + 1000 * DATA.triggerset;;    name = sprintf('%s/%s.p%dt%d%s.mat',spkdir,b,p,eid,xs);    if strcmp(namemode,'checkauto') && ~exist(name,'file') %onlye write to spikes if not there already        name = sprintf('%s/%s.p%dt%d%s.mat',spkdir,b,p,eid,xs);    end        