function DATA = CalcICA(DATA,ns)        AllVoltages = AllV.mygetappdata(DATA,'AllVoltages');chspk = DATA.chspk;uid = DATA.uid;if DATA.csd     if DATA.csd == 2    csd = diff(AllVoltages,2,1);    else    csd = diff(AllVoltages,1,1);    end    TV = csd(chspk(1),:,uid);    for j = 2:length(chspk)        TV = cat(2,TV,csd(chspk(j),:,uid));    endelseif DATA.dvdt == 2    TV = AllVoltages(chspk(1),:,uid);    TV = cat(2,TV,diff(AllVoltages(chspk(1),:,uid),1,2));    for j = 2:length(chspk)        TV = cat(2,TV,AllVoltages(chspk(j),:,uid));        TV = cat(2,TV,diff(AllVoltages(chspk(j),:,uid),1,2));    endelseif DATA.dvdt == 3    TV = diff(AllVoltages(chspk(1),:,uid),2,2);    for j = 2:length(chspk)        TV = cat(2,TV,diff(AllVoltages(chspk(j),:,uid),2,2));    endelseif DATA.dvdt    TV = diff(AllVoltages(chspk(1),:,uid),1,2);    for j = 2:length(chspk)        TV = cat(2,TV,diff(AllVoltages(chspk(j),:,uid),1,2));    endelse    TV = AllVoltages(chspk(1),:,uid);    for j = 2:length(chspk)        TV = cat(2,TV,AllVoltages(chspk(j),:,uid));    endendTV = squeeze(TV)';if diff(size(TV)) > 0DATA.icas = FastICA(TV,'numofic',ns);elseDATA.icas = FastICA(TV','numofic',ns)';endif ns < 5 %fill with zero for plotting    DATA.icas(end,5) = 0;end