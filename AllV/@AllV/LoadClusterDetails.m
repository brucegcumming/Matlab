function [DATA, ClusterDetails] = LoadClusterDetails(DATA, varargin)%[DATA, ClusterDetails] = LoadClusterDetails(DATA, varargin) Loads%Load ClusterDetails File belonging to data% ....,'orauto')  will load AutoClusterDetails if no ClusterDetails% (default)% ....,'noauto')  will not load AutoClusterDetails if no ClusterDetails% ....,'auto')  will just load AutoClusterDetails    force = 0;    forceauto = 0;    ClusterDetails = {};    loadautoifempty = 1;        j = 1;    while j <= length(varargin)        if strcmpi(varargin{j},'auto')            forceauto = 1;        elseif strcmpi(varargin{j},'noauto')            loadautoifempty = 0;        elseif sum(strcmpi(varargin{j},{'orauto' 'ifauto'}))            loadautoifempty = 1;        elseif strcmpi(varargin{j},'reload')            force =1;        end        j = j+1;    end        ngood = 0;    Clusters = AllV.mygetappdata(DATA,'Clusters');    if DATA.interactive >= 0 && DATA.loadedClusterDetails == DATA.exptno && force == 0        ClusterDetails = AllV.mygetappdata(DATA,'ClusterDetails');        for j = 1:length(ClusterDetails)            if ~isempty(ClusterDetails{j})                 if ~isfield(ClusterDetails{j},'triggerset')                    ClusterDetails{j}.triggerset = 0;                end                if ClusterDetails{j}.triggerset ~= DATA.triggerset                    ClusterDetails{j} = {};                else                    ngood = ngood+1;                end            end        end        if ~isempty(ClusterDetails) && ngood > 0 %loaded and matches triggerset            return;        end    end    afile = AllV.ClusterFile(DATA.name,DATA,'details','auto');    cfile = AllV.ClusterFile(DATA.name,DATA,'details');    AutoDetails = {};    if strcmp(DATA.cutmode,'auto') || forceauto        cfile = afile;    end    if exist(cfile)        fprintf('Loading %s\n',cfile);        load(cfile);    elseif exist(afile) && loadautoifempty        fprintf('Loading %s\n',afile);        load(afile);    end    for j = 1:length(ClusterDetails)        if isempty(ClusterDetails{j}) && loadautoifempty            if  exist(afile) && isempty(AutoDetails)                X = load(afile);                AutoDetails = X.ClusterDetails;            end            if length(AutoDetails) >= j                ClusterDetails{j} = AutoDetails{j};            end        end        if isfield(ClusterDetails{j},'Evec') && ~isfield(ClusterDetails{j}.Evec,'chspk')            if isfield(Clusters{j},'chspk')            chspk = Clusters{j}.chspk;        else            chspk = SetProbesToUse(DATA,j,1);        end            if Clusters{j}.csd                chspk = chspk-1;                chspk = chspk(chspk > 0);            end            ClusterDetails{j}.Evec.chspk = chspk;        end        if ~isempty(ClusterDetails{j}) && ~isfield(ClusterDetails{j},'triggerset')            ClusterDetails{j}.triggerset = 0;        end    end    if ~isempty(ClusterDetails)        DATA = AllV.mysetappdata(DATA,'ClusterDetails',ClusterDetails);        DATA.loadedClusterDetails = DATA.exptno;    else %%may want to set loadedClusterDetails to 0?    end        