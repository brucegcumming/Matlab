function PreferencesPopup(a,b, fcn)  DATA = GetDataFromFig(a);  if nargin == 1       GetFigure(DATA.tag.preferences,DATA.toplevel);      SetFigPos(DATA,DATA.tag.preferences);      f = fields(DATA.gui);      nr = length(f)+3;      nc = 2;      bp(3) = 0.95./nc;      bp(4) =0.95./nr;      for j = 1:length(f)          bp(1) = 0.01;          bp(2) = 0.01+(j).* 1./nr;          uicontrol(gcf,'style','Text','String',f{j},...              'fontsize',DATA.gui.fontsize,...              'units','normalized','position',bp);          bp(1) = 0.5;          uicontrol(gcf,'style','edit','String',num2str(DATA.gui.(f{j})),...              'Tag',f{j},...              'fontsize',DATA.gui.fontsize,...              'units','normalized','position',bp);      end      bp(1) = 0.01;      bp(2) = (length(f)+1)./nr;      uicontrol(gcf,'style','checkbox','String','Use Last layout on Start',...          'units','normalized',...          'fontsize',DATA.gui.fontsize,...          'value',DATA.options.UseLastLayout,...          'Callback',{@AllV.PreferencesPopup, 'UseLastLayout'},'position',bp);      bp(1) = 1/nc;      uicontrol(gcf,'style','checkbox','String','Use Last config on Start',...          'units','normalized',...          'fontsize',DATA.gui.fontsize,...          'value',DATA.options.UseLastConfig,...          'Callback',{@AllV.PreferencesPopup, 'UseLastConfig'},'position',bp);      bp(2) = 0.01;      uicontrol(gcf,'style','pushbutton','String','Apply',...          'units','normalized',...          'fontsize',DATA.gui.fontsize,...          'Callback',{@AllV.PreferencesPopup, 'apply'},'position',bp);  elseif strcmp(fcn,'apply')      f = fields(DATA.gui);      for j = 1:length(f)          DATA.gui.(f{j}) = AllV.Text2Val(get(a,'parent'),f{j});      end      close(get(a,'parent'));      set(DATA.toplevel,'UserData',DATA);  elseif sum(strcmp(fcn,{'UseLastConfig' 'UseLastLayout'}))      DATA.options.(fcn) = get(a,'value');      SetData(DATA);  end