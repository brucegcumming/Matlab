function cmenu = AddLineContextMenu(DATA, h, e, p, varargin)    setcl = 0;    setdup = 0;    pid = 0;    starth = 2; %default is to ignore first line    j = 1;        while j <= length(varargin)        if strncmpi(varargin{j},'cellnum',5)            j = j+1;            xc = getappdata(DATA.toplevel,'xcCellList');            pid = varargin{j};            setcl = xc(pid).cl;            a = xc(pid).p;            starth = 1;        elseif strncmpi(varargin{j},'duplicate',5)            j = j+1;            setdup = varargin{j};        end        j = j+1;    end    cells = unique(DATA.CellList(:));    cells = cells(cells > 0);    for j = starth:length(h)        if h(j) > 0 && ishandle(h(j))            cmenu = uicontextmenu;            if setcl                k = DATA.CellList(e,p,setcl);            elseif j > size(DATA.CellList,3)+1 || e > size(DATA.CellList,1)                k = 0;            else                k = DATA.CellList(e,p,j-1);            end            if k > 0                uimenu(cmenu,'label',sprintf('Spike%d Cell%d',j-1,k),'foregroundcolor',get(h(j),'color'));                c = uimenu(cmenu,'label','clear','Callback',{@PC.DeleteCellFromLine, j-1,  k});            else                uimenu(cmenu,'label',sprintf('Spike%d',j-1),'foregroundcolor',get(h(j),'color'));            end            if setdup                uimenu(cmenu,'label',sprintf('Duplicate of %d',setdup),'Callback',{@PC.SetCellFromLine, pid,  'duplicate'});            end            uimenu(cmenu,'label','&spool','Callback',{@PC.SetCellFromLine, j-1,  'spool'});            uimenu(cmenu,'label','&optimize','Callback',{@PC.SetCellFromLine, j-1,  'optimize'});            uimenu(cmenu,'label','->FullV','Callback',{@PC.SetCellFromLine, j-1,  'getfullv'});        for k = 1:50            c = uimenu(cmenu,'label',sprintf('Cell %d',k),'Callback',{@PC.SetCellFromLine, j-1,  k});            if ismember(k,cells)                set(c,'Foregroundcolor','g');            end            if k == 1                set(c,'separator','on');            end        end        set(h(j),'uicontextmenu',cmenu);        end    end