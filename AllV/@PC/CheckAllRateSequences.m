    function R = CheckAllRateSequences(DATA)                plottype = 2;Expts = getappdata(DATA.toplevel,'Expts');Clusters = getappdata(DATA.toplevel,'Clusters');R.cellid = [];if isempty(Clusters)    return;endexname = unique(DATA.expnames);exname = exname(~strcmp('',exname)); %remove blanksIm = zeros(length(Expts),max(DATA.CellList(:)));    cellid = unique(DATA.CellList);    cellid = cellid(cellid > 0);x = getappdata(DATA.toplevel,'RateCheckData');if isfield(x,'plottype')    R.plottype = x.plottype;else    R.plottype = 'cv';endif isempty(cellid)    return;endfor j = 1:length(exname)    expid = find(strcmp(exname{j},DATA.expnames));%exid is true expt numbers        eid = find(ismember(DATA.CellDetails.exptids,expid)); %row indices    for k = 1:length(cellid)        c = cellid(k);        E = {};        for e = 1:length(eid)            [p, cl] = find(squeeze(DATA.CellList(eid(e),:,:)) == c);            if length(p) > 1                fprintf('Cell %d Doubly Defined Expt %d P %s\n',c,eid(e),sprintf('%d ',p));                p = p(1);                cl - cl(1);            end            if ~isempty(p)                E{e} = PC.CountExptSpikes(DATA, Expts{expid(e)}, Clusters{eid(e)}{p},cl);            end        end        if ~isempty(E)        check = CheckExptRates(E,'print');        R.ff(j,k) = max([check.errs.ff]);        R.blkcv(j,k) = check.blkcv;        R.blkff(j,k) = check.blkff;        R.blkskew(j,k) = check.blkskew;        R.warning(j,k) = sum(check.warning(2:end));        R.slopes(j,k) = max(abs([check.errs.slope]));        exid = [check.errs.exptno];        Im(exid,c) = check.errs.ff;        ffid = find([check.errs.ff] > DATA.checkrate.ff);        Im(exid(ffid),c) = Im(exid(ffid),c)+1;         a = find(abs([check.errs.slope]) > DATA.checkrate.slope);        Im(exid(a),c) = Im(exid(a),c)+2;         a = find(abs(log([check.diffs])) > DATA.checkrate.diff);        if length(a) > 2 && sum(check.warning(2:end)) == 0            a; %not useful?         end        R.diffs(j,k) = max(abs(log([check.diffs])));        Im(exid(a),c) = Im(exid(a),c)+4;         R.Im = Im;        end    endendR.cellid = cellid;setappdata(DATA.toplevel,'RateCheckData',R)      PC.SetFigure(DATA,DATA.tag.clusters);PC.PlotRateCheck(R);