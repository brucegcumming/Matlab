function DATA = CheckExclusion(DATA,varargin)        fixerrs = 0;    nerr = 0;    j = 1;    while j <= length(varargin)        if strncmpi(varargin{j},'fixnonid',6)            fixerrs = 1;        end        j = j+1;    end        Expts = getappdata(DATA.toplevel,'Expts');    Clusters = getappdata(DATA.toplevel,'Clusters');    if isempty(Expts)        return;    end    exlist = GetExptNumber(Expts);    exid = DATA.CellDetails.exptids;    for j = 1:size(DATA.CellDetails.excludetrials,1)        if j <= length(exid)        e = find(ismember(exlist,exid(j)));        for k = 1:size(DATA.CellDetails.excludetrials,2)            for c = 1:size(DATA.CellDetails.excludetrials,3)                X = DATA.CellDetails.excludetrials{j,k,c};                if length(X) && ~isempty(e)                    ids = [Expts{e}.Trials.id];                    id = find(ismember(ids,X));                    if length(id) < length(X)                        nid = setdiff(X,ids);                        fprintf('Excluded E%dP%dC%d: %d/%d ids are not in expt. Expt Range %d-%d. First error %d\n',j,k,c,length(id),length(X),min(ids),max(ids),nid(1));                        nerr = nerr+1;                        if fixerrs == 1                            DATA.CellDetails.excludetrials{j,k,c} = id;                        end                    end                end            end        end        else            fprintf('exludeids longer than exptids');        end    end    n =1;    fprintf('Checking Exclusion lists: %d errors\n',nerr);    cells = unique(DATA.CellList);    cells = cells(cells > 0);        for j = 1:length(cells)        [ceid, pid, cid] = PC.FindCell(DATA,cells(j));        eid = DATA.CellDetails.exptids(ceid); %expt numbers        [eid, id, xid] = intersect(eid, DATA.exptid); %expts that match in Expts        xid = ceid(id);        pid = pid(id);        cid = cid(id);        for k = 1:length(eid)            C = PC.GetClusterInfo(Clusters,xid(k),pid(k),cid(k),'allexpt');            if ~isempty(C)                if isfield(C,'clst')                    if sum(C.clst == cid(k)+1) == 0                        fprintf('No Spikes in Cluster for Cell %d in E%dP%dC%d\n',cells(j),eid(k),pid(k),cid(k));                    end                    nc = sum(DATA.CellList(xid(k),pid(k),:) == cells(j));                    if nc > 1                        fprintf('cell %d defined twice in E%dP%d\n',cells(j),eid(k),pid(k));                    end                end            end        end    end    if nerr && fixerrs        PC.SaveCellList(DATA,'backup');    end    %    set(DATA.toplevel,'UserData',DATA);