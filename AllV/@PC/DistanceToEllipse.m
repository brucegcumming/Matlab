function distance = DistanceToEllipse(E, pos);   if isempty(E) | ~isfield(E,'pos');    distance = NaN;    return;enda(1) = (E.pos(3)+E.pos(1))/2; %x radiusa(2) = (E.pos(4)+E.pos(2))/2;if E.shape == 1angle = atan(diff(E.pos([1 3]))/diff(E.pos([2 4])));r(1) = abs(E.pos(3)-E.pos(1) + i * (E.pos(4)-E.pos(2)))/4;r2 = r(1)/10;elser(1) = (E.pos(3)-E.pos(1))/2; %x radiusr(2) = (E.pos(4)-E.pos(2))/2;angle = E.angle;endxy = pos - a;xy = xy ./r;cn = cos(-angle);sn = sin(-angle);p(1) = xy(1) * cn + xy(2) * sn;p(2) = xy(2) * cn - xy(1) * sn;distance = sum(p.^2);