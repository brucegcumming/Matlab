function h= DrawEllipse(E,varargin)if E.shape(1) == 1 || E.shape(1) == 2    h = PC.DrawLine(E,varargin{:});    return;endif ~isfield(E,'xyr')  || E.down E.xyr(1) = mean(E.pos([1 3]));E.xyr(2) = mean(E.pos([2 4]));E.xyr(3) = abs(diff(E.pos([1 3])))/2;E.xyr(4) = abs(diff(E.pos([2 4])))/2;endyl = get(gca,'ylim');xl = get(gca,'xlim');x = get(gca,'position');fp = get(gcf,'position');ar = abs(diff(x([1 3])).* diff(fp([1 3])) ./   (diff(x([2 4])) .*diff(fp([2 4]))));a = E.xyr(3); %x radius in nomalized unitsb = E.xyr(4);sn = 0;cn = 1;x = linspace(0,a);if isfield(E,'aspectratio') && E.aspectratio > 0    b  = b ./E. aspectratio;    y =  sqrt(b.^2 - (x.*b/a).^2);else    y =  sqrt(b.^2 - (x.*b/a).^2);endsn = sin(E.angle);cn = cos(E.angle);x = [x fliplr(x) -x fliplr(-x)];y = [y fliplr(-y) -y fliplr(y)];xr = (x .* cn + y .*sn);yr = (y .* cn - x .*sn);x = xr+mean(E.xyr(1));if isfield(E,'aspectratio') && E.aspectratio > 0    y = yr.*E.aspectratio+mean(E.xyr(2));else    y = yr+mean(E.xyr(2));end    if isfield(E,'h') & ishandle(E.h) & strcmp(get(E.h,'type'),'line')    set(E.h,'Xdata',real(x),'Ydata',real(y));    h = E.h;else    hold on;    h = plot(real(x),real(y),varargin{:});    hold off;end