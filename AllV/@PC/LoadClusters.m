function [Clusters, details] = LoadClusters(name)%loadClusters  loads a cluster set by filenameexptno = -1;if ~exist(name,'file')    Clusters = {};    details = [];    return;endload(name);details.loadname = name;details.loadtime = now;Clusters = Clusters;for j = 1:length(Clusters)    if isfield(Clusters{j},'exptno')        exptno = Clusters{j}.exptno;    end    if isfield(Clusters{j},'clst')        fprintf('%s P%d has clst\n',name,j);        if length(Clusters{j}.clst) ~= length(Clusters{j}.times)            Clusters{j} = rmfield(Clusters{j},'clst');        end    endendif exptno < 0    id = strfind(name,'Expt');    if length(id)        [exptno, a,b,c] = sscanf(name(id(1)+4:end),'%d');        if name(id(1)+3+c) == 'a'            exptno = exptno+0.1;        end    endenddetails.exptno = exptno;dname = strrep(name,'.mat','Details.mat');if ~exist(dname,'file')dname = strrep(name,'ClusterTimes','ClusterTimesDetails.mat');end    if exist(dname)    ClusterDetails = LoadClusterDetails(dname);else    mycprintf('errors','Can''t find %s\n',dname);    ClusterDetails = [];    return;endif exist('FullVData','var')    details.FullVData = FullVData;endfor j = 1:length(ClusterDetails)    if isfield(ClusterDetails{j},'xy')%        Clusters{j}.xy = ClusterDetails{j}.xy;        Clusters{j}.xy = PC.RawXY(Clusters{j}, ClusterDetails{j}.xy);        if isfield(ClusterDetails,'next')            nc = min([length(ClusterDetails{j}.next) length(Clusters{j}.next)]);        for k = 1:nc            if isfield(ClusterDetails{j}.next{k},'xy') && isfield(Clusters{j}.next{k},'space');                Clusters{j}.next{k}.xy = ClusterDetails{j}.next{k}.xy;                Clusters{j}.next{k}.xy = PC.RawXY(Clusters{j}.next{k},ClusterDetails{j}.next{k}.xy);            end        end        end        if isfield(ClusterDetails{j},'clst')            Clusters{j}.clst = ClusterDetails{j}.clst;        else            Clusters{j}.clst = ones(size(ClusterDetails{j}.t));            id = find(ismember(ClusterDetails{j}.t,Clusters{j}.times));            Clusters{j}.clst = ones(size(ClusterDetails{j}.t));        Clusters{j}.clst(id) = 2;        end    Clusters{j}.times = ClusterDetails{j}.t;    if isfield(Clusters{j},'t')        Clusters{j} = rmfield(Clusters{j},'t');    end    if exptno >= 0    Clusters{j}.exptno = exptno;    end    end    if isfield(ClusterDetails{j},'Evec')        Clusters{j}.Evec = ClusterDetails{j}.Evec;    end    if isfield(ClusterDetails{j},'triggerV')        Clusters{j}.triggerV = ClusterDetails{j}.triggerV;    end    if isfield(ClusterDetails{j},'next')        for k = 1:length(ClusterDetails{j}.next)            if isfield(ClusterDetails{j}.next{k},'xy')                Clusters{j}.next{k}.xy = ClusterDetails{j}.next{k}.xy;            end        end    end    if isfield(ClusterDetails{j},'trigset') && isfield(ClusterDetails{j}.trigset{1},'clst')        Clusters{j}.trigset{1}.clst = ClusterDetails{j}.trigset{1};        C = ClusterDetails{j}.trigset{1};        for k = 1:length(C.next)            if k > length(Clusters{j}.next) || isempty(Clusters{j}.next)                Clusters{j}.next{k}.xy = C.next{k}.xy;                Clusters{j}.next{k} = C.next{k};            end        end    endend