function varargout = PlotAllCell(DATA, type, varargin)    Clusters = getappdata(DATA.toplevel,'Clusters');           cellid = 0;   tag = [];   j = 1;   while j <= length(varargin)       if strncmpi(varargin{j},'cell',4)           j = j+1;           cellid = varargin{j};       end       j = j+1;   end      varargout = {};   for j = 1:nargout       varargout{j} = [];   end      if cellid == 0       it = findobj('Tag','CellNumberId');       cellid = get(it,'value');       if isempty(cellid)           cellid = 1;       end   end   colors = mycolors('spkcolors');   if strcmp(type,'allcellspks')       GetFigPos(DATA.toplevel); %record current window location and use this.       cells = unique(DATA.CellList);       cells = cells(cells > 0);       nex = 0;       for j = cells'           eids{j} = PC.PlotAllCell(DATA,'allspks','cell',j);           nex(j) = length(eids(j));           F = KeepFigure(DATA.tag.allspikes);           set(F,'Name',sprintf('Cell %d Spikes',j));           drawnow;       end       fprintf('%d graphs\n',sum(nex));       return;   end       ts = now;        id = find(DATA.CellList == cellid);    [eid, cid, clid] = ind2sub(size(DATA.CellList),id);        [eid, id] = sort(eid);    cid = cid(id);    AllSpikes = PC.CheckAllSpikes(DATA, eid, cid,'allprobes');    clid = clid(id);    cid = 1+mod(cid-1,DATA.nprobes);    [nr,nc] = Nsubplots(length(eid));    if strncmp(type,'allspks',7)        PC.SetFigure(DATA,DATA.tag.allspikes);    else        PC.SetFigure(DATA,DATA.tag.allxy);    end    subplot(1,1,1);    varargout{1} = eid;    for j = 1:length(eid)        mysubplot(nr,nc,j);        hold off;         if strcmp(type,'trighist')            hist(Clusters{eid(j)}{cid(j)}.trighist);        elseif strncmp(type,'allspks',7)            C = Clusters{eid(j)}{cid(j)};            if strcmp(type,'allspkswithmean')                h = PC.QuickSpikes(DATA, AllSpikes{eid(j),cid(j)},C,'showmean','ontop',1+clid(j));            else                h = PC.QuickSpikes(DATA, AllSpikes{eid(j),cid(j)},C,'empty','ontop',1+clid(j));            end            if clid(j) ~= 1                                np = clid(j)+1;                if length(h) >= np                      set(h(np,myhandle(h(np,:))),'color','r');                    set(h(2,myhandle(h(2,:))),'color',colors{np});                elseif length(h) > 1                    set(h(2,myhandle(h(2,:))),'color','k');                else                    set(h(1,:),'color','k');                end            end            if DATA.show.linecontextmenus                PC.AddLineContextMenu(DATA, h, eid(j), cid(j));            end            dstr = datestr(AllSpikes{eid(j),cid(j)}.Header.ctime);            dstr = dstr(1:6);           h = PC.AddTitle(DATA, PC.GetClusterInfo(C,clid(j)), 2);           %h = title(sprintf('E%.1fP%d 1D%.1f 2D%.1f %s',C.exptno,cid(j),C.mahal(4),C.mahal(1),dstr));        end        set(gca,'Xtick',[],'Ytick',[]);        h = get(gca,'title');        xl = get(gca,'xlim');        yl = get(gca,'ylim');        a = get(h,'position');        a(2) = yl(2);        a(1) = mean(xl);        set(h,'position',a,'VerticalAlignment','top');        set(gca,'ButtonDownFcn',{@PC.HitXYPlot, eid(j), cid(j)});        c = get(gca,'Children');        for k = 1:length(c)            set(c(k),'ButtonDownFcn',{@PC.HitXYPlot, eid(j), cid(j)});        end    end    if DATA.profiling        fprintf('took %.2f\n',mytoc(ts));        profile viewer;    end    