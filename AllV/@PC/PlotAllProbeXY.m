function DATA = PlotAllProbeXY(DATA,varargin)    %plots all probes for one expt    oneprobe = 0;    selectprobes = [];    axdatatype = [];    plotexpt = [];    j =1;    while j <= length(varargin)        if strncmpi(varargin{j},'oneprobe',7)            oneprobe = 1;        elseif strncmpi(varargin{j},'expt',4)            j = j+1;            plotexpt = varargin{j};        elseif strncmpi(varargin{j},'select',6)            oneprobe = 2;            if length(varargin) > j && isnumeric(varargin{j+1})            j = j+1;            selectprobes = varargin{j};            end        end        j = j+1;    end            Clusters = getappdata(DATA.toplevel,'Clusters');    eid = DATA.currentpoint(1);    p = DATA.currentpoint(2);    if length(plotexpt)        pid = 1:DATA.nprobes;        expts = ones(size(pid)).*plotexpt;        np = DATA.nprobes;    elseif oneprobe == 1        np = length(Clusters);        expts = 1:np;        pid = ones(size(expts)) .* DATA.currentpoint(2);    elseif oneprobe > 1        if isempty(selectprobes)             if isfield(DATA,'usepeaks') && sum(DATA.usepeaks>0) > 1                expts = find(DATA.usepeaks > 0);                pid = DATA.usepeaks(expts);            else                [expts, pid] = find(DATA.selectprobe > 0);            end        else        [expts, pid] = find(selectprobes > 0);        end        np = length(expts);    else %All XY one expt        [Clusters, DATA] = PC.CheckClusterLoaded(DATA, eid);        if isfield(DATA.ArrayConfig,'X')            np = length(DATA.ArrayConfig.X);        else            np = length(Clusters{eid});        end        pid = 1:np;        expts = ones(size(pid)) .* eid;    end    if strcmp(DATA.ArrayConfig.type,'12x2')        nr = 4;        nc = 6;    else        [nr,nc] = Nsubplots(np);    end    PC.SetFigure(DATA,DATA.tag.allxy);    set(gcf,'Name','Building all XY...');    drawnow;    plotpos = PC.SetPlotPos(DATA, np, nr, nc);    fprintf('Building All XY\n');    ClearPlot();    for j = 1:np        if isfield(DATA.ArrayConfig,'X')            mysubplot(nr,nc,plotpos(j),'tight');                    else            mysubplot(nr,nc,j);        end        hold off;         if oneprobe == 1            xyplots = PC.PlotClusterXY(DATA,Clusters{j}{p},'vshorttitle','tight');            missed = PC.MissedCell(DATA,[j p]);        elseif oneprobe > 1            xyplots = PC.PlotClusterXY(DATA,Clusters{expts(j)}{pid(j)},'vshorttitle','tight');            missed = PC.MissedCell(DATA,[expts(j) pid(j)]);        else            xyplots = PC.PlotClusterXY(DATA,Clusters{eid}{j},'vshorttitle','tight');            missed = PC.MissedCell(DATA,[eid j]);        end        if ~isempty(xyplots)            set(xyplots(1),'ButtonDownFcn',{@PC.HitXYPlot, eid, j});        end        set(gca,'Xtick',[],'Ytick',[]);        if DATA.plot.trighist            PC.AddTrigHist(DATA,Clusters{expts(j)}{pid(j)},DATA.currentcluster);        end        if missed            h = get(gca,'title');            set(h,'color','g');        end        c = get(gca,'Children');        c = setdiff(c,xyplots);        for k = 1:length(c)            set(c(k),'ButtonDownFcn',{@PC.HitXYPlot, eid, pid(j)});        end        PC.AddCellLabels(DATA, expts(j), pid(j));                axdata.type = axdatatype;        set(gca,'ButtonDownFcn',{@PC.HitXYPlot, eid, pid(j)});                end    DATA.selectprobe = zeros(length(DATA.exptid),DATA.nprobes);    set(gcf,'Name',DATA.tag.allxy);