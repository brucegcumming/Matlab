function DATA = PlotExptsProbe(DATA, type);%plots all Expts for one probe    oldf = gcf;    DATA = PC.ClearSelections(DATA,0,0);    Clusters = getappdata(DATA.toplevel,'Clusters');    expts = 1:length(DATA.exptid);    nex = length(expts);    [nr, nc] = Nsubplots(nex);    p = DATA.currentpoint(2);    allplot.type = type;    if strmatch(type,'allprobespks')        AllSpikes = PC.CheckAllSpikes(DATA, expts, p,'allprobes');        PC.SetFigure(DATA,DATA.tag.allspikes);        set(gcf, 'KeyPressFcn',{@PC.KeyPressed,3},'Keyreleasefcn',{@PC.KeyReleased, 3});    elseif strmatch(type,'alltemplatespks')        for j = 1:length(DATA.usepeaks)            AllSpikes = PC.CheckAllSpikes(DATA, expts, abs(DATA.usepeaks(expts(j))),'allprobes');        end        PC.SetFigure(DATA,DATA.tag.allspikes);        set(gcf, 'KeyPressFcn',{@PC.KeyPressed,3},'Keyreleasefcn',{@PC.KeyReleased, 3});    elseif  strmatch(type,{'AllprobeXY' 'AllTemplateXY' 'AllExptXY'})        PC.SetFigure(DATA,DATA.tag.allxy);        set(gcf, 'KeyPressFcn',{@PC.XYKeyPressed,3},'Keyreleasefcn',{@PC.KeyReleased, 3});    end%AllXY this probe comes here    newf = gcf;    setappdata(gcf,'allplot',allplot);    fname  = get(gcf,'Name');    set(gcf,'name',sprintf('Building Plot E%dP%d...',expts(1),p(1)));    setappdata(0,'alt_is_down',0);    setappdata(0,'control_is_down',0);    drawnow;    figure(newf);    for j = 1:length(expts)        mysubplot(nr,nc,j);        hold off;        eid = expts(j);        axdata.type = 'probeexpt';        axdata.toplevel = DATA.toplevel;        axdata.eid = eid;        axdata.probe = p;        [Clusters, DATA] = PC.CheckClusterLoaded(DATA, eid);        if strmatch(type,{'allprobespks' 'alltemplatespks'})            if strmatch(type,'alltemplatespks')                p = abs(DATA.usepeaks(expts(j)));            end            C = Clusters{expts(j)}{p};            adjid = [eid-1 eid+1];            adjid = adjid(adjid > 0 & adjid <= size(AllSpikes,1));            [a,b] = PC.isacell(DATA,eid,p);            [c,d] = PC.isacell(DATA,adjid,p);            id = find(c >0);            if length(id)                c = c(id(1));                [e,d] = PC.isacell(DATA,adjid(c),p);            else                c = 0;            end            if a > 0 || sum(strcmp(type,{'allprobespks' 'alltemplatespks'}))               [h, x] = PC.QuickSpikes(DATA, AllSpikes{eid,p},C,'showmean');                axdata.lines = h;                PC.AddLineContextMenu(DATA, h, eid, p);                ylim = get(gca,'ylim');                xlim = get(gca,'xlim');                if a > 0 || c > 0                    if (a > 0)                        th = title(sprintf('E%.0fP%d 1D%.1f 2D%.1f',C.exptno,p,C.mahal(4),C.mahal(1)));                        set(th,'color','b','fontweight','bold');                    else                        th=title(sprintf('E%.0fP%d 1D%.1f 2D%.1f',C.exptno,p,C.mahal(4),C.mahal(1)));                    end                    axdata.celllabels = PC.AddCellLabels(DATA, eid, p,'adjacent',adjid);                else                    th=title(sprintf('E%.0fP%d 1D%.1f 2D%.1f',C.exptno,p,C.mahal(4),C.mahal(1)));                end                set(gca,'ButtonDownFcn',{@PC.HitXYPlot, eid,p });                PC.TightPlot(gca);            end        elseif strmatch(type,{'AllprobeXY' 'AllTemplateXY'})            if strmatch(type,'AllTemplateXY')                p = DATA.usepeaks(eid);                if p == 0                    p = DATA.currentpoint(2);                end                p = abs(p);            end            if iscluster(Clusters,eid,p)            xyplots = PC.PlotClusterXY(DATA,Clusters{eid}{p},'shorttitle','tight','cellid',DATA.currentcluster);            title(sprintf('E%dP%d:%.1f %.1f',DATA.exptid(eid),p,PC.DistanceMeasure(Clusters{eid}{p},1,DATA.mahaltype),Clusters{eid}{p}.dropi(3)));            missed = PC.MissedCell(DATA,[eid p]);            set(xyplots(1),'ButtonDownFcn',{@PC.HitXYPlot, eid, p});            axdata.lines = xyplots;            axdata.allxy = 1;            PC.AddLineContextMenu(DATA, xyplots, eid, p);            PC.FastAxes(gca);            if DATA.plot.trighist                PC.AddTrigHist(DATA,Clusters{eid}{p},DATA.currentcluster);            end            if missed                h = get(gca,'title');                set(h,'color','g');            end            c = get(gca,'Children');            c = setdiff(c,xyplots);            for k = 1:length(c)                set(c(k),'ButtonDownFcn',{@PC.HitXYPlot, eid, p});            end            PC.AddCellLabels(DATA, eid, p);            set(gca,'ButtonDownFcn',{@PC.HitXYPlot, eid, p},'UserData',axdata);            end        end        set(gca,'UserData',axdata);    end         set(gcf,'name',fname);         %set(gcf,'renderer',DATA.renderer);         drawnow;%set(0,'CurrentFigure',oldf);figure(oldf);%gcf