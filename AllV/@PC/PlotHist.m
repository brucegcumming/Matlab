function [x, nsp, crit] = PlotHist(xy, varargin)    E = [];    gmfit = [];    noplot = 0;    crit = 0;    j = 1;    while j <= length(varargin)        if isfield(varargin{j},'pos') || isfield(varargin{j},'crit')            E = varargin{j};            p = E.probe(1);            eid = E.exptid;        elseif isfield(varargin{j},'gmfit1d') || isfield(varargin{j},'gmfit2d')            gmfit = varargin{j};        elseif iscell(varargin{j}) && isfield(varargin{j}{1},'gmfit2d')            gmfit = varargin{j}{eid,p};        elseif strcmp(varargin{j},'noplot')            noplot = 1;        end        j = j+1;    end        if E.shape == 0        r = PC.CalcRadius(E, E.xy);        [nsp,x] = hist(sqrt(r),200);        scale = trapz(x,nsp);        crit = 1;    else        xy = xyrotate(xy(:,1),xy(:,2),E.angle);        [nsp,x] = hist(xy(:,1),200);        scale = trapz(x,nsp);        crit = E.crit;    end    if noplot        return;    end    hold off;        bar(x,nsp,1);            if E.shape == 0        hold on;        plot([1 1],[0 max(nsp)],'r');    elseif isfield(gmfit,'gmfit1d')        [a,b] = GMDip(xy,gmfit.gmfit1d);        hold on;        plot(b.gxy(:,1),b.gxy(:,2).*scale,'color','g');        plot(b.gxy(:,1),b.gxy(:,3).*scale,'color','g');        plot(b.gxy(:,1),sum(b.gxy(:,[2 3]),2).*scale,'r');        plot([E.crit(1) E.crit(1)],[0 max(nsp)],'r');        plot([E.crit(1) E.crit(1)],[0 max(nsp)],'r');    else        hold on;        b.gxy(:,1) = linspace(min(xy(:,1)),max(xy(:,1)));        gmsd = NaN;        plot([E.crit(1) E.crit(1)],[0 max(nsp)],'r');    end        