function PlotSyncSpikes(DATA, eid, probes, clnum, varargin)j = 1;showasync = 100;if DATA.plot.synctmax > 0    tlim = DATA.plot.synctmax .* 10;else    tlim = 20;end    nstep = 10;while j <= length(varargin)    if strncmpi(varargin{j},'flip',4)        probes = fliplr(probes);    elseif strncmpi(varargin{j},'tmax',4)        j = j+1;        tlim = varargin{j}(1);        if length(varargin{j}) > 1            nstep = round(varargin{j}(2)/2);        end    end    j = j+1;end     AllSpikes = PC.CheckAllSpikes(DATA, eid, probes,'allprobes'); Clusters = getappdata(DATA.toplevel,'Clusters');  atid = find(Clusters{eid}{probes(1)}.clst == clnum(1)+1); btid = find(Clusters{eid}{probes(2)}.clst == clnum(2)+1); if isempty(AllSpikes)     xct = -(tlim/10000):0.0002:(tlim/10000);     [xc, b] = xcorrtimes(Clusters{eid}{probes(1)}.times(atid),Clusters{eid}{probes(2)}.times(btid),'times',xct);     PC.SetFigure(DATA,DATA.tag.spikes);     plot(b.xpts, xc);     return; end ta = AllSpikes{eid,probes(1)}.times(atid); tb = AllSpikes{eid,probes(2)}.times(btid); [a, aid, bid]= intersect(round(ta/10),round(tb/10));% bid = find(ismember(round(ta/10),round(tb+10/10)));  aid = [];bid = [];dts = [];for j = 1:length(ta)    dt = ta(j)-tb;%find all events witin tlime and show them        id = find(abs(dt) < tlim)';    if length(id)        aid = [aid j * ones(size(id))];        bid = [bid id];        dts = [dts dt(id)'];    endend% id = union(aid,bid);voff = AllSpikes{eid,probes(1)}.maxv .* AllSpikes{eid,probes(1)}.maxint/2;x = [1:size(AllSpikes{eid, probes(1)}.values,2)]./40;hold off;Q = AllSpikes{eid,probes(2)};P = AllSpikes{eid,probes(1)};CompareSpikeWaves(P,Q,atid(aid),btid(bid),'clusterid',clnum);if showasync    cid = setdiff(atid,atid(aid));    did = setdiff(btid,btid(bid));    if length(cid) > showasync        cid = cid(1:round(length(cid)/showasync):end);    end    if length(did) > showasync        did = did(1:round(length(cid)/showasync):end);    end    if ~isempty(cid) && ~isempty(did)        CompareSpikeWaves(P,Q,cid,did,'clusterid',clnum,'xpos',3);    endend yl = get(gca,'ylim'); xl = get(gca,'xlim'); if tlim <= 50     [y,x] = hist(dts,-tlim:2:tlim); else     [y,x] = hist(dts,-tlim:5:tlim); end if showasync     text(3,yl(1),'Asynchronous','verticalalignment','bottom'); endpmax = max(y)./length(atid);y = y .* yl(2)./max(y);x  = linspace(xl(1), xl(2),length(y));title(sprintf('%d events (of %d) within +- %.2fms pmax %.3f',length(aid),length(atid),tlim./10,pmax));%x = (x-min(x)) .* xl(2)./max(x);%x = x+xl(1);plot(x,y,'ro-');