function RateSeqKeyPressed(src, ks, fcn)    if strmatch(ks.Key,{'shift' 'control' 'alt'})        return;    endif ~(ismember(ks.Character,'+-' ) | sum(strcmp(ks.Key,{'leftarrow' 'rightarrow' 'uparrow' 'downarrow'})))    return;endDATA = GetDataFromFig(src);Expts = getappdata(DATA.toplevel,'Expts');D = get(gcf,'UserData');if ~isfield(D,'currentexpt') || D.currentexpt > length(D.exptlist)    D.currentexpt = 1;endtag = get(src,'tag');bt = strmatch(get(gcf,'SelectionType'),{'normal' 'alternate'  'extend'  'open'});if strcmp(ks.Key,'rightarrow')    if D.currentexpt < length(D.exptlist)        D.currentexpt = D.currentexpt+1;    endelseif strcmp(ks.Key,'leftarrow')    if D.currentexpt > 1        D.currentexpt = D.currentexpt-1;    endelseif strcmp(ks.Key,'uparrow')    nspks = 0;    while DATA.currentcell < max(DATA.CellList(:)) && nspks == 0        DATA.currentcell = DATA.currentcell+1;        nspks = CountCellSpikes(DATA, DATA.currentcell);    endelseif strcmp(ks.Key,'downarrow')    nspks = 0;    while DATA.currentcell > 1 && nspks == 0        DATA.currentcell = DATA.currentcell-1;        nspks = CountCellSpikes(DATA, DATA.currentcell);    endendeid = D.exptlist(D.currentexpt);DATA.currentpoint(1) = eid;set(gcf,'UserData',D); if isempty(ks.Character)elseif ismember(ks.Character,'+') || sum(strcmp(ks.Key,{'leftarrow' 'rightarrow'}))     t(1) = Expts{eid}.Header.timeoffset+Expts{eid}.Trials(1).TrialStart/10000;    t(2) = Expts{eid}.Header.timeoffset + Expts{eid}.Trials(end).TrialStart*1.01/10000;    t = t - D.timeadjust(D.currentexpt);    set(gca,'xlim',t);    if strcmp(ks.Modifier,'shift')        DATA = PC.RateZoom(DATA, 1, DATA.currentcell);    else        DATA= PC.RateZoom(DATA,2, DATA.currentcell);        title(sprintf('Expt%d %s',eid,DATA.expnames{eid}));    endendif  sum(strcmp(ks.Key,{'uparrow' 'downarrow'}))     D = get(gcf,'UserData');    if length(D.cellids) > 1    DATA = PC.RateZoom(DATA, 1, DATA.currentcell);      else        PC.PlotMenu(DATA, [], 'cells', 'rateseqone');    endendif ks.Character == '-'    X = get(gcf,'UserData');    set(gca,'ylim',X.yrange);    if strcmp(ks.Modifier,'shift')        set(gca,'xlim',X.xrange);    endendset(DATA.toplevel,'UserData',DATA);function nspk = CountCellSpikes(DATA, cellid)nspk = 0;DATA.markexpts;if strcmp(DATA.markexpts,'none')    eid = DATA.exptid;else    eid = find(strcmp(DATA.markexpts,DATA.expnames));end[a,b,c] = PC.FindCell(DATA, cellid);for j = 1:length(eid)    e = find(DATA.exptid ==eid(j));    id = find(a ==e);    if ~isempty(id)        C = PC.GetClusterInfo(DATA,[e, b(id) c(id)]);        nspk = nspk + C.ncut;    endend