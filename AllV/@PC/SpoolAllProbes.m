function stopped = SpoolAllProbes(DATA, e, Spikes, Clusters, varargin)        usetrials = [];    j = 1;    while j <= length(varargin)        if strncmpi(varargin{j},'Trials',5)            j = j+1;            usetrials = varargin{j};        end        j = j+1;    end    DATA.usegmcid = 0;    DATA.plotspk.bytrial = 1;    DATA.voffset = [1:DATA.nprobes] .*2;    Expts = getappdata(DATA.toplevel,'Expts');    DATA.Expt = Expts{e};    stopped = 0;        chspk = [];    for j = 1:length(chspk)        if ~isempty(AllSpikes{e,chspk(j)})            Spks(j+1) = AllSpikes{e,chspk(j)};        end    end    for j = 1:length(chspk)        Spks(j+1).probe = chspk(j);    end   F =  PC.SetFigure(DATA, DATA.tag.allspikes);   %subplot(1,1,1);   stopbtn = findobj(F, 'tag','StopSpool');   for k = 1:length(Spikes)       p = Spikes{k}.probe;       if isfield(Spikes{k},'VRange')           ranges(k,:) = Spikes{k}.VRange;       else           ranges(k,:) = minmax(Spikes{k}.values(:));       end       if DATA.plotspk.showexcluded           xcls{k} = [];       else       xcls{k} = PC.FindExcludedTrials(DATA,e,p,1,Clusters{p});       end   end   tic;    if length(usetrials)       Trials = Expts{e}.Trials(usetrials);   else       Trials = Expts{e}.Trials;   end    xcl = [];    if length(Spikes) == 24        nr = 6;        nc=4;    elseif length(Spikes) == 96        nr = 10;        nc=10;        plotpos = PC.SetPlotPos(DATA, length(Spikes),nr,nc);    else        [nr,nc] = Nsubplots(length(Spikes));    end    if DATA.profiling        profile on;    end        c = get(gcf,'Children');    types = get(c,'type');    axs = c(strcmp('axes',types));    for j = 1:length(Trials)        set(F,'name',sprintf('Ex%.0f Trial %d',DATA.exptid(e),Trials(j).Trial));        for k = 1:length(Spikes)            p = Spikes{k}.probe;            chspk = [p-1 p+1];            chspk = chspk(chspk > 0 & chspk <= DATA.nprobes);            subplot(axs(p));            %mysubplot(nr,nc,p,'tight');            C = Clusters{p};            if ~ismember(j, xcls{k})                DATA.currenttrial = j;                if DATA.options.usesavedcodes                ispk = find(Spikes{k}.times > Trials(j).Start(1) & Spikes{k}.times < Trials(j).End(end));                else                ispk = find(C.times > Trials(j).Start(1)./10000 & C.times < Trials(j).End(end)./10000);                end                PC.PlotSpikes(DATA, [e p], ispk, Spikes{k}, C, 'fixy',ranges(k,:),'empty');                [a,b] = PC.isacell(DATA,e,p);                if a                    xl = get(gca,'xlim');                    yl = get(gca,'ylim');                    if length(xcls{k})                        str = sprintf('%d *',b);                    else                        str = sprintf('%d ',b);                    end                    set(gca,'xcolor','b','ycolor','b','linewidth',2);                    text(mean(xl), yl(2), sprintf('Cell %s',str),'VerticalAlignment','top','color','b','fontweight','bold');                end                set(gca,'ButtonDownFcn',{@PC.HitXYPlot, e,p});            end        end        drawnow;        stopped = get(stopbtn,'value');        if stopped            set(stopbtn,'value',0);            return;        end    endtoc    if DATA.profiling        profile viewer;    end