function XYButtonDragged(src, data)    persistent tslast;    ts = now; DATA = GetDataFromFig(src);if isfield(DATA,'elmousept') &&  DATA.elmousept.down >0%    fprintf('D%d,%d %.2f %.2f\n',DATA.elmousept.down,DATA.elmousept.steps,DATA.elmousept.pos(1),DATA.elmousept.pos(3));control_is_down = getappdata(0,'control_is_down');cc = get(gcf,'currentcharacter'); DATA.elmousept.steps = DATA.elmousept.steps +1; if  DATA.elmousept.down == 1    start = get(gca,'CurrentPoint');    DATA.elmousept.pos(3) = start(1,1);    DATA.elmousept.pos(4) = start(1,2);%    axes(DATA.xyax);    if ~control_is_down %%cntrl stops the ellipse from drawing. Speeds things up in and AllXY plot        DATA.elmousept.h = PC.DrawEllipse(DATA.elmousept, DATA.elmousept.plotargs{:});    end%    axes(DATA.allxyax);%    DATA.elmousept.lh = PC.testDrawEllipse(DATA.elmousept, DATA.elmousept.plotargs{:});% with drawnow here, takes a long time with AllXY. But without% jst takes that time outside the subroutine% try using Line (annotaiton) and deleting each time? %    drawnow;%    mytoc(DATA.ts);elseif  DATA.elmousept.down == 3 %set radius with R mouse button    if DATA.elmousept.shape == 0 %set radius with R mouse button    start = get(gca,'CurrentPoint');    r = abs(start(1,1:2) - DATA.elmousept.xyr(1:2));    sina = sin(DATA.elmousept.angle);    cosa = cos(DATA.elmousept.angle);    r = r * [cosa sina; -sina cosa];    DATA.elmousept.xyr([3 4]) = r;    DATA.elmousept.pos(1) = DATA.elmousept.xyr(1)-DATA.elmousept.xyr(3);    DATA.elmousept.pos(2) = DATA.elmousept.xyr(2)-DATA.elmousept.xyr(4);    DATA.elmousept.pos(3) = DATA.elmousept.xyr(1)+DATA.elmousept.xyr(3);    DATA.elmousept.pos(4) = DATA.elmousept.xyr(2)+DATA.elmousept.xyr(4);    DATA.elmousept.h = PC.DrawEllipse(DATA.elmousept, DATA.elmousept.plotargs{:});    else %for line R press doesnt move line. Just inverts cluster.sign    endelseif  DATA.elmousept.down == 2 %moving ellipse    start = get(gca,'CurrentPoint');    if DATA.elmousept.steps > 5        start = get(gca,'CurrentPoint');    end    DATA.elmousept.pos(1) = start(1,1)-DATA.elmousept.start(1)+DATA.elmousept.xyr(1)-DATA.elmousept.xyr(3);    DATA.elmousept.pos(2) = start(1,2)-DATA.elmousept.start(2)+DATA.elmousept.xyr(2)-DATA.elmousept.xyr(4);    DATA.elmousept.pos(3) = start(1,1)-DATA.elmousept.start(1)+DATA.elmousept.xyr(1)+DATA.elmousept.xyr(3);    DATA.elmousept.pos(4) = start(1,2)-DATA.elmousept.start(2)+DATA.elmousept.xyr(2)+DATA.elmousept.xyr(4);    DATA.elmousept.h = PC.DrawEllipse(DATA.elmousept, DATA.elmousept.plotargs{:});endset(DATA.toplevel,'UserData',DATA);if DATA.profiling    if tslast == 0        tslast = ts;    end    fprintf('Took %.3f (%.3f)\n',mytoc(ts),(ts-tslast)*60*60*24);endendtslast = ts;