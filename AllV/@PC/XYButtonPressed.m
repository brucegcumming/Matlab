function XYButtonPressed(src, data)    DATA = GetDataFromFig(src);    tag = PC.GetFigureTag(src);    testnew = 0;    if strcmp(tag,DATA.tag.allxy) && DATA.allclustering == 0 % need to set the currentpoint so that plots right thing.        axdata = get(gca,'UserData');        DATA.currentpoint(1) = axdata.eid;        DATA.currentpoint(2) = axdata.probe;        set(DATA.toplevel,'UserData',DATA);        return;    end    if DATA.elmousept.shape < 0        return;    endDATA.ts = now;start = get(gca,'CurrentPoint');if PC.InGraph(start,gca)    mode = strmatch(get(gcf,'SelectionType'),{'normal' 'alternate'  'extend'  'open'})    if DATA.currentcluster ~= DATA.currentcutcluster        Clusters = getappdata(DATA.toplevel,'Clusters');        fprintf('Replotting XY for cluster %d\n',DATA.currentcutcluster);                PC.PlotClusterXY(DATA,Clusters{DATA.currentpoint(1)}{DATA.currentpoint(2)},'cellid',DATA.currentcutcluster);        PC.AddCellLabels(DATA, DATA.currentpoint(1), DATA.currentpoint(2),'NW');        xy = PC.AxPos(gca,[1 1]);        text(xy(1),xy(2),sprintf('Reset to cl%d',DATA.currentcutcluster),'HorizontalAlignment','right','verticalalignment','top');        DATA.currentcluster = DATA.currentcutcluster;    end    DATA.elmousept.mode = mode;    distance = PC.DistanceToEllipse(DATA.elmousept,start(1,1:2));    DATA.elmousept.steps = 0;    if ishandle(DATA.elmousept.h)        delete(DATA.elmousept.h);    end    set(gca,'xlimmode','manual','ylimmode','manual');    yl = get(gca,'ylim');    xl = get(gca,'xlim');    DATA.elmousept.aspectratio = diff(yl)./diff(xl);    if  mode  == 2 %right button press        DATA.elmousept.down = 3;        DATA.elmousept.done = 0;        if DATA.elmousept.shape == 0 %for line, don't move            DATA.elmousept.start = start(1,1:2);        end    elseif distance < 1.05 %test fails for NaN%pressed inside ellipse, so just tmove it.         DATA.elmousept.down = 2;        DATA.elmousept.pos =[0  0 0 0 ];        DATA.elmousept.start = start(1,1:2);        DATA.elmousept.axis = gca;%set up pos in case released with no drag            DATA.elmousept.pos(1) = DATA.elmousept.xyr(1)-DATA.elmousept.xyr(3);    DATA.elmousept.pos(2) = DATA.elmousept.xyr(2)-DATA.elmousept.xyr(4);    DATA.elmousept.pos(3) = DATA.elmousept.xyr(1)+DATA.elmousept.xyr(3);    DATA.elmousept.pos(4) = DATA.elmousept.xyr(2)+DATA.elmousept.xyr(4);    else        if testnew         ax = gca;        axdata = get(ax,'UserData');        if isfield(axdata,'allxy') && axdata.allxy ==1            Clusters = getappdata(DATA.toplevel,'Clusters');            GetFigure(DATA.tag.xyplot);            PC.PlotClusterXY(DATA,Clusters{axdata.eid}{axdata.probe},'shorttitle','tight');            DATA.xyax = gca;            axes(ax);            DATA.allxyax = ax;        end        end        DATA.elmousept.down = 1;        DATA.elmousept.done = 0;        if ~isfield(DATA.elmousept,'angle') %if there, should have been set to match cluster            DATA.elmousept.angle = 0;        end        DATA.elmousept.pos =[start(1,1) start(1,2) 0 0 ];        DATA.elmousept.axis = gca;    endset(DATA.toplevel,'UserData',DATA);end