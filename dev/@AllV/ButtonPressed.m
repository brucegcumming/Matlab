function ButtonPressed(src, data)DATA = GetDataFromFig(src);DATA.ts = now;start = get(gca,'CurrentPoint');if AllV.InGraph(start,gca)    mode = strmatch(get(gcf,'SelectionType'),{'normal' 'alternate'  'extend'  'open'});%    DATA.elmousept.mode = mode;%only check for in ellipse if in correct space    C = AllV.ClusterInfo(DATA);    DATA.elmousept.pcplot = get(gca,'UserData');    distance = AllV.DistanceToEllipse(DATA.elmousept,start(1,1:2));%Not so simple. When an ellipse is drawn in a new space, C.space is not%updated until clicking inside. %    if length(DATA.elmousept.pcplot) == 2 && length(C.space) > 1%        if isfield(C,'space') &&  sum(C.space(end-1:end) == DATA.elmousept.pcplot) < 2%            distance = 100%        end    %end    if ishandle(DATA.elmousept.h)        if get(DATA.elmousept.h,'Parent') == gca  %only inside if its teh right subplot            axisok = 1;        else            axisok = 0;        end    else        axisok = 1;    end    yl = get(gca,'ylim');    xl = get(gca,'xlim');    set(gca,'xlimmode','manual','ylimmode','manual'); %dont rescale for ellispes    DATA.elmousept.aspectratio = diff(yl)./diff(xl);    if  mode  == 2 % R button press. Inside and existing ellispe sets cutting to that space        DATA.elmousept.down = 3;        DATA.elmousept.done = 0;        DATA.elmousept.start = start(1,1:2);        [x, c] =  AllV.FindNearestCluster(DATA, start(1,1:2));        if x < 1            DATA = AllV.SetEllipseDrawing(DATA,0,'cluster',c);        end    elseif distance < 1.05 && axisok%test fails for NaN%pressed inside ellipse, so just tmove it.         DATA.elmousept.down = 2;        DATA.elmousept.pos =[0  0 0 0 ];        DATA.elmousept.start = start(1,1:2);        DATA.elmousept.axis = gca;%set up pos in case released with no drag             DATA.elmousept.pos(1) = DATA.elmousept.xyr(1)-DATA.elmousept.xyr(3);    DATA.elmousept.pos(2) = DATA.elmousept.xyr(2)-DATA.elmousept.xyr(4);    DATA.elmousept.pos(3) = DATA.elmousept.xyr(1)+DATA.elmousept.xyr(3);    DATA.elmousept.pos(4) = DATA.elmousept.xyr(2)+DATA.elmousept.xyr(4);    else        DATA.elmousept.down = 1;        DATA.elmousept.done = 0;        DATA.elmousept.pos =[start(1,1) start(1,2) 0 0 ];        DATA.elmousept.axis = gca;        yl = get(gca,'ylim');        xl = get(gca,'xlim');        DATA.elmousept.aspectratio = diff(yl)./diff(xl);  %if drawing in a new space, set cluster angle to zero.            DATA.elmousept.pcplot = get(gca,'UserData');        if length(DATA.elmousept.pcplot) == 2 && length(C.space) > 1            if isfield(C,'space') &&  sum(C.space(end-1:end) == DATA.elmousept.pcplot) < 2                DATA.elmousept.angle = 0;            end        end                if 0        if ~isfield(DATA.elmousept,'angle')            DATA.elmouept.angle = 0 ;        end        if ~isfield(DATA.elmousept,'plotargs')            DATA.elmouept.plotargs = {} ;        end        end    endset(DATA.toplevel,'UserData',DATA);end