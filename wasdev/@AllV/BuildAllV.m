function [AllVoltages, DATA] = BuildAllV(DATA, id, spts)    V = AllV.mygetappdata(DATA,'Vall');    allid = repmat(id,length(spts),1) + repmat(spts',1,length(id));    if isappdata(DATA.toplevel,'AllInts')        Vi = getappdata(DATA.toplevel, 'AllInts');        AllVoltages = reshape(Vi(:,allid),[size(Vi,1) size(allid)]);    else        AllVoltages = reshape(V.V(:,allid),[size(V.V,1) size(allid)]);    end    if isinteger(AllVoltages)        AllVoltages = double(AllVoltages) .* V.intscale(1)/V.intscale(2);    end    DATA = AllV.mysetappdata(DATA,'AllVoltages',AllVoltages);    if isfield(V,'meanV')        DATA.meanV = V.meanV(allid);        DATA = AllV.mysetappdata(DATA,'MeanV',DATA.meanV);        if DATA.addmean            for j = 1:size(AllVoltages,1)                AllVoltages(j,:,:) = squeeze(AllVoltages(j,:,:)) + DATA.meanV;            end        end    end    DATA.energy = [];    DATA.spkvar = [];    DATA.energy(1,:) = sqrt(squeeze(sum(diff(AllVoltages(DATA.probe(1),:,:),1,2).^2,2)));    DATA.spkvar(DATA.probe(1),:) = squeeze(std(AllVoltages(DATA.probe(1),:,:),[],2));    DATA.nevents = size(AllVoltages,3);