 function CheckClusters(Clusters, str, varargin)     if isempty(Clusters)         return;     end     if strcmp(str,'CheckFitSpace')         for j = 1:length(Clusters)             if iscell(Clusters)                 C = Clusters{j};             else                 C = Clusters(j);             end             if isfield(C,'gmfit') && isfield(C.gmfit,'mu') %might be empty                             if C.space(1) == 6                 fitsz = size(C.gmfit.mu,2);                 spacesize = [4 2 4 6 6 6 4];                 ssz = spacesize(C.space(2));                 if fitsz ~= ssz;                     if C.auto                         astr = 'auto';                     else                         astr = '';                     end                     if length(Clusters) > 1                         cstr = sprintf('%d',j);                     else                         cstr = sprnintf('P%d',C.probe);                     end                     fprintf('Cluster %s Space %d, %d dims, but fit %d dims %s\n',cstr,C.space(2),ssz,fitsz,astr);                 end             end             end         end         return;     end     if strcmp(str,'CheckNexts')         nexterrs = 0;         for j = 1:length(Clusters)             if iscell(Clusters)                 C = Clusters{j};             else                 C = Clusters(j);             end                          if isfield(C,'next') %might be empty                  wasempty = 0;                 for k = 1:length(C.next)                     if isempty(C.next{k})                         wasempty = 1;                     elseif wasempty                         wasempty = 2;                     end                 end                 if wasempty == 1 && k > 1 %trailing empty next                     fprintf('Expt %d Probe %d Cluster missing next{%d}\n',C.exptno,j,k);                     nexterrs = nexterrs+1;                 end             end         end         %allowed empty nexts now.         if nexterrs%                 errordlg(sprintf('Missing Nexts in %d Clusters at %s',nexterrs,varargin{1}),'Cluster Load error','modal');         end         return;     end     for j = 1:length(Clusters)         C = Clusters{j};         if ~isfield(Clusters{j},'mahal') %empty really             missing(j) = 1;             fprintf('Missing Cluster on %d\n',j);         else             missing(j) = 0;         end         if ~isfield(Clusters{j},'MeanSpike')             fprintf('Missing Meanspike on %d\n',j);             missing(j) = 2;         end         if isfield(Clusters{j},'restricttimerange') && length(C.restricttimerange) == 2             if min(C.times) > C.restricttimerange(2) || max(C.times) < C.restricttimerange(1)                 errordlg(sprintf('Bad Time range for probe %d',j),'restrict time error');             end         end     end nerr = sum(missing); if nerr     cprintf('red','Missing %d Clusters at %s',nerr,str); end nm = sum(missing == 2); if nm     cprintf('red','Missing %d MeanSpikes at %s',nm,str); end            