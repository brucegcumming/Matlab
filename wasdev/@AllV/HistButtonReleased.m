function HistButtonReleased(src, data)HDATA = get(src,'UserData');  % Just for this figurestart = get(gca,'CurrentPoint');F = gcf;if isfield(HDATA,'elmousept') && HDATA.elmousept.downHDATA.elmousept.down = 0;HDATA.elmousept.done = 1;p = HDATA.elmousept.pos;if HDATA.elmousept.mode == 3HDATA.elmousept.xyr = [mean(p([1 3])) mean(p([2 4])) diff(p([1 3]))/2 diff(p([2 4]))/2]; elseHDATA.elmousept.xyr = [mean(p([1 3])) mean(p([2 4])) diff(p([1 3]))/2 diff(p([2 4]))/2]; endset(src,'UserData',HDATA);%now get main data DATA = GetDataFromFig(src);mode = HDATA.elmousept.mode;if HDATA.elmousept.mode == 3DATA.cluster.crit = p(1);E = AllV.BoundaryFromCluster(HDATA.elmousept, DATA.cluster, DATA.currentcluster);elseE = AllV.BoundaryFromCluster(HDATA.elmousept, DATA.cluster, DATA.currentcluster);E.pos = p;end[cl, DATA.cluster, DATA.xy{DATA.currentcluster}] = AllV.ClassifySpikes(DATA,E,DATA.quickcutmode);DATA.cluster.auto = 0;DATA.clid = cl.id;DATA.nid = cl.nid;DATA.clst = cl.clst;if isfield(cl,'MeanSpike')    DATA.MeanSpike = cl.MeanSpike;endset(DATA.toplevel,'UserData',DATA);E.h = [];if DATA.watchplots == 0 %otherwise plotted in Replot    DATA = AllV.ReplotPCs(DATA,E);endif mode == 1    AllV.PlotHistogram(DATA,[]);else    figure(F);    title(sprintf(' G2 %.2f',DATA.cluster.fitdprime(1)));endend