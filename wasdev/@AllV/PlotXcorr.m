function PlotXcorr(a,b, pa, pb)DATA = GetDataFromFig(a);F = GetFigure(a);cells = getappdata(DATA.toplevel,'xcCellList');if strcmp(pa,'zoom')    xl = get(gca,'xlim');    bt = strmatch(get(gcf,'SelectionType'),{'normal' 'alternate'  'extend'  'open'})    if bt == 2         xl(1) = xl(1)*2;        xl(2) = xl(2)*2;    elseif bt ==1        xl(1) = xl(1)/2;        xl(2) = xl(2)/2;    end    set(gca,'xlim',xl);    return;endDataClusters = AllV.mygetappdata(DATA,'Clusters');AllV.SetFigure(DATA.tag.xcorr, DATA);if strcmp(DATA.plot.xcorrtype,'meanim')    mysubplot(2,4,3);    P = AllV.Cell2Cluster(cells(pa),DataClusters);    imagesc(P.MeanSpike.ms);    set(gca','xtick',[],'ytick',[]);    h = title(sprintf('%d/%d',cells(pa).p,cells(pa).cl));    set(h,'verticalalignment','middle')    mysubplot(2,4,4);    Q = AllV.Cell2Cluster(cells(pb),DataClusters);    cl = minmax(cat(1,Q.MeanSpike.ms(:),P.MeanSpike.ms(:)));    caxis(cl);    imagesc(Q.MeanSpike.ms);    caxis(cl);    set(gca','xtick',[],'ytick',[]);    h = title(sprintf('%d/%d',cells(pb).p,cells(pb).cl));    set(h,'verticalalignment','middle')    xc = AllV.ShapeCorr(P,Q);    return;elseif strcmp(DATA.plot.xcorrtype,'histograms')endmysubplot(2,2,2);P = AllV.Cell2Cluster(cells(pa),DataClusters);Q = AllV.Cell2Cluster(cells(pb),DataClusters);[xc, details]  = xcorrtimes(P.times,Q.times);if pa == pb    xc(details.midpt) = 0;endhold off;plot(details.xpts,xc,'k','linewidth',2);axis('tight');yl = get(gca,'ylim');xl = get(gca,'xlim');[a,b] = max(xc);text(xl(2),yl(2),sprintf('%.0fms %.3f %d/%d %d/%d',...    details.xpts(b).*1000,max(details.efficacy),...    cells(pa).p,cells(pa).cl,cells(pb).p,cells(pb).cl),'horizontalalignment','right','verticalalignment','top');line([0 0],yl,'linestyle','--');set(gca,'buttondownfcn', {@AllV.PlotXcorr, 'zoom', 2});AllV.SyncSpikes(DATA,cells([pa pb]));